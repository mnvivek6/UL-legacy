<%- include('../layouts/header.ejs') %>

<head>

    <!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="Chitrakoot Web" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="Multipurpose eCommerce Template + Admin" />
    <meta name="description" content="Smartshop - Multipurpose eCommerce Template + Admin" />

    <!-- title  -->
    <title>UL</title>

    <!-- favicon -->
    <link rel="shortcut icon" href="/user/img/logos/ULfavicon.jpg">
    <link rel="apple-touch-icon" href="user/img/logos/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="user/img/logos/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="user/img/logos/apple-touch-icon-114x114.png">

    <!-- plugins -->
    <link rel="stylesheet" href="user/css/plugins.css">

    <!-- theme core css -->
    <link href="user/css/styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
</head>

<body>

    <!-- PAGE LOADING
    ================================================== -->
    <!-- <div id="preloader"></div> -->

    <!-- MAIN WRAPPER
    ================================================== -->
    <div class="main-wrapper mp-pusher" id="mp-pusher">

        <!-- HEADER
        ================================================== -->
        <header class="fixed header-light-nav">

            

            <div class="navbar-default">

                <!-- top search -->
                <div class="top-search bg-primary">
                    <div class="container-fluid">
                        <form class="search-form" action="#" method="GET">
                            <div class="input-group">
                                <span class="input-group-addon cursor-pointer">
                                    <button class="search-form_submit fas fa-search display-27 text-white" type="submit"></button>
                                </span>
                                <input type="text" class="search-form_input form-control" name="s" autocomplete="off" placeholder="Type & hit enter...">
                                <span class="input-group-addon close-search"><i class="fas fa-times display-27 mt-2"></i></span>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- end top search -->

                <div class="container-fluid p-0">
                    <div class="row align-items-center g-0">
                        <div class="col-12 col-lg-12">
                            <div class="menu_area alt-font">
                                <nav class="navbar navbar-expand-lg navbar-light p-0">

                                    <!-- category toggler -->
                                    <a href="#" id="trigger" class="menu-trigger"><i class="ti-menu"></i></a>
                                    <!-- end category toggler -->

                                    <div class="navbar-header navbar-header-custom">
                                        <!-- logo -->
                                        <!-- <a href="index.html" class="navbar-brand logodefault"><img id="logo" src="user/img/logos/logo.png" alt="logo"></a> -->
                                        <!-- end logo -->
                                    </div>

                                    <!-- menu toggler -->
                                    <div class="navbar-toggler"></div>
                                    <!-- end menu toggler -->

                                    <!-- menu area -->
                                    <ul class="navbar-nav mx-auto" id="nav" style="display: none;">

                                        <li><a href="/userhome">Home</a>
                                          
                                        </li>
                                      
                                        </li>
                                        <li><a href="#">Account</a>
                                            <ul>
                                                <%if(user == false){%>
                                          
                                                    <li><a href="/logout">logout</a></li>
                                            <%}else{%>
                                                <li><a href="/login">login</a>
                                                
                                               
                                            <%}%>
                                                <!-- <li><a href="adfs">Password Recovery</a></li> -->
                                                <li><a href="/orderlist">Orders List</a></li>
                                                <li><a href="/whishlist">Wishlist</a></li>
                                                <li><a href="/userprofile">Profile Page</a></li>
                                                <!-- <li><a href="account-address.html">Contact / Shipping Address</a></li> -->
                                                <!-- <li><a href="account-tickets.html">My Tickets</a></li>
                                                <li><a href="account-single-ticket.html">Single Ticket</a></li> -->
                                            </ul>
                                        </li>
                                        
                                        
                                        <li><a href="#">Shop</a>
                                            <ul>
                                                <li><a href="/shop">Shop Categories</a></li>
                                            </ul>
                                        </li>
                                       
                                    </ul>





                                    <!-- end menu area -->

                                    <!-- attribute navigation -->
                                    <div class="attr-nav">
                                        <ul>
                                            <li class="dropdown me-3 me-lg-0">
                                                <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">
                                                    <i class="ti-bag"></i>
                                                    <span class="badge bg-primary">3</span>
                                                </a>
                                                <ul class="dropdown-menu cart-list">
                                                    
                                                    <li>
                                                        <a href="#" class="photo"><img src="" class="cart-thumb" alt="..." /></a>
                                                        <h6><a href="#"> </a></h6>
                                                        <p>2x - <span class="price"></span></p>
                                                    </li>
                                                    <li class="total bg-primary">
                                                        <span class="float-start"><strong>Total</strong>: $79.20</span>
                                                        <a href="shop-cart.html" class="butn-style2 small white float-end w-auto"><span>View Cart</span></a>
                                                    </li>
                                                </ul>
                                            </li>
                                            <li class="search"><a href="#"><i class="ti-search"></i></a></li>
                                        </ul>
                                    </div>
                                    <!-- end attribute navigation -->

                                </nav>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </header>
        
        <!-- CATEGORY MP-MENU
        ================================================== -->
        <!-- PAGE TITLE
        ================================================== -->
       
        <!-- CART TABLE
        ================================================== -->
        <section class="md">
            <div class="container">

                <div class="row">

                    <!-- product table -->
                    <div class="col-12 shop-cart-table">
                        <table class="table shop-cart text-center">
                            <colgroup>
                                <col width="100">
                                    <col>
                                        <col width="1">
                                            <col>
                                                <col width="100">
                                                    <col width="1">
                            </colgroup>
                           
                            <% if(userData.cart.length == 0){%>
                                <h4 style="color: red;">Ooops there is nothing in your cart..!!!</h4>
                          <%  }else{%>
    
                            <thead>
                                <tr>
                                    <th class="first">Image</th>
                                    <th class="text-start text-uppercase font-weight-500">Product</th>
                                    <th class="text-start text-uppercase font-weight-500">Price</th>
                                    <th class="text-center text-uppercase font-weight-500">Qty</th>
                                    <th class="text-start text-uppercase font-weight-500">SubTotal</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <% userData.cart.forEach((cart, index) => {
                                    const productId = cart.productId;
                                  
                                    if (productId && productId.productname) {
                                  %>
                                    <tr>
                                      <td class="product-thumbnail text-start">
                                        <a href="#"><img src="/img/<%=cart.productId.image[0]%>" alt="..." ></a>
                                      </td>
                                      <td class="text-start">
                                        <a href="#"><%= productId.productname %></a>
                                        <span class="text-uppercase d-block">SKU: 290397</span>
                                      </td>
                                      <td class="text-start">
                                        <%= productId.price %>
                                      </td>
                                    
                                        
                                   
                                      <td class="product-quantity">
  <button style="border: none;border-radius:3px; padding:0 16px 0 16px"
    onclick="cartquantityupdation('<%= userData._id %>','<%= productId._id %>',-1,'<%= productId.price %>')"> -</button>
  <span id="<%= productId._id %>">
    <%= cart.qty %>
  </span>                                               
  <button style="border: none;border-radius:3px; padding:0 16px 0 16px"
    onclick="cartquantityupdation('<%= userData._id %>','<%= productId._id %>',1,'<%= productId.price %>', '<%= productId.quantity %>')"> + </button>
</td>

                                     
                                     
                                      
                                    
                                      <td class="product-subtotal text-start">
                                        <h5 class="<%= productId._id %>"><%= cart.productTotalprice %></h5>
                                      </td>
                                      <td class="product-remove text-center">
                                        <button class="butn-style2 small bg-color mb-2 mb-md-0"
                                          onclick="deleteCartProduct('<%= userData._id %>','<%= productId._id %>')">
                                          Remove cart
                                        </button>
                                      </td>
                                    </tr>
                                  <% 
                                    }
                                  }) %>
                                  
                            
                                
                            </tbody>
                        </table>
                    </div>
                   
                    <!-- end product table -->

                    <!-- button set -->
                    <div class="col-12 border-bottom py-1-9 py-lg-2-3 mb-3 mb-md-4 mb-lg-0">
                        <!-- <button class="butn-style2 small bg-color mb-2 mb-md-0"><span>Empty Cart</span></button> -->
                        <!-- <a href="/checkout"><button class="butn-style2 small bg-color float-end ms-2 mb-2 mb-md-0"><span>BUY NOW</span></button></a> -->
                        <!-- <button class="butn-style2 dark"><span><i class="fas fa-heart me-1"></i><a href="">Buy Now</a> </span></button> -->

                    </div>
                    <!-- end button set -->

                    <!-- total block set -->
                    <div class="col-12 cart-total pt-1-9 pt-lg-2-3">
                        <div class="row">

                           
                            <div class="col-lg-6 offset-lg-1 col-md-7 offset-md-0">
                                <table class="table cart-sub-total">
                                    <tbody>
                                        
                                        <tr>
                                            <td class="pe-0 p-0" colspan="2">
                                                <hr>
                                            </td>
                                        </tr>
                                        <tr class="total">
                                            <th class="text-uppercase text-end pe-0 p-0">Cart Total Price</th>
                                            <td class="text-uppercase text-end pe-0 p-0"><%=userData.cartTotalPrice%></td>
                                        </tr>
                                        <tr>
                                            <td class="pe-0 p-0" colspan="2">
                                                <hr class="mb-0">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <a class="butn-style2 float-end" href="/checkout"><span>Proceed to Checkout</span></a>
                            </div>
                            <%}%>
                        </div>
                    </div>
                    <!-- end total block set -->

                </div>

            </div>
        </section>
        
        <!-- FOOTER
        ================================================== -->
        <footer class="classic-footer bordered">

            <div class="container">
                <div class="row">

                    <div class="col-lg-4 col-md-6 mb-2-3 mb-lg-0">
                        <h3>Contact Us</h3>
                        <ul class="list-style mb-2 ps-0">
                            <li>
                                <strong>Address:</strong><span class="ps-1">74 Guild Street 542B, Town MT.</span>
                            </li>
                            <li>
                                <strong>Phone: </strong><span class="ps-1">(+44) 123 456 789</span>
                            </li>
                            <li>
                                <strong>Email: </strong><span class="ps-1">addyour@emailhere</span>
                            </li>
                        </ul>

                        <ul class="list-style-two mb-0 ps-0">
                            <li>
                                <a href="#"><i class="fab fa-facebook-f"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="fab fa-twitter"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="fab fa-instagram"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            </li>
                        </ul>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-2-3 mb-lg-0">

                        <div class="row">
                            <div class="col-md-6 col-6 pe-lg-0">
                                <h3>Quick Links</h3>
                                <ul class="list-style ps-0">
                                    <li><a href="#">News</a></li>
                                    <li><a href="#">History</a></li>
                                    <li><a href="#">Our shop</a></li>
                                    <li><a href="#">Secure shopping</a></li>
                                    <li><a href="#">Privacy policy</a></li>
                                </ul>
                            </div>
                            <div class="col-md-6 col-6 pe-lg-0">
                                <h3>My Account</h3>
                                <ul class="list-style ps-0">
                                    <li><a href="#">My Account</a></li>
                                    <li><a href="#">Order History</a></li>
                                    <li><a href="#">Wish List</a></li>
                                    <li><a href="#">Newsletter</a></li>
                                    <li><a href="#">Returns</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-12">
                        <div class="ps-lg-1-9">

                            <div class="row">
                                <div class="col-lg-12 col-md-6 mb-1-9">
                                    <h3>News Letter</h3>
                                    <form method="post">
                                        <div class="form-group footer-subscribe">
                                            <input type="email" placeholder="Subscribe with us" id="email" class="form-control">
                                            <a href="#" class="butn-style2"><i class="fas fa-paper-plane display-27 mt-1"></i></a>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-lg-12 col-md-6">
                                    <h3>Download Our Mobile Apps</h3>
                                    <div class="text-start">
                                        <a href="#" class="btn bordered text-start ms-1 ms-md-0 mt-1 mt-md-0 mb-0 mb-lg-2 mb-xl-0">
                                            <span class="media align-items-center">
                                        <span class="fab fa-apple display-26 pe-3"></span>
                                            <span class="media-body">
                                            <span class="d-block display-32">Download on the</span>
                                            <strong>App Store</strong>
                                            </span>
                                            </span>
                                        </a>

                                        <a href="#" class="btn bordered text-start ms-1 ms-lg-0 ms-xl-1 mt-1 mt-md-0">
                                            <span class="media align-items-center">
                                        <span class="fab fa-google-play display-26 pe-3"></span>
                                            <span class="media-body">
                                            <span class="d-block display-32">Get it on</span>
                                            <strong>Google Play</strong>
                                            </span>
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>

            <div class="footer-bottom py-1-9 mt-6 mt-lg-8">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <div class="text-center text-md-start">
                                <p class="mb-0">&copy; <span class="current-year"></span> Smartshop is Powered by <a href="https://www.chitrakootweb.com/" target="_blank" class="text-dark">Chitrakoot Web</a></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-style-17 text-center text-md-end">
                                <li><img src="user/img/content/payment-options/visa.png" alt="..."></li>
                                <li><img src="user/img/content/payment-options/mastercard.png" alt="..."></li>
                                <li><img src="user/img/content/payment-options/paypal.png" alt="..."></li>
                                <li><img src="user/img/content/payment-options/amex.png" alt="..."></li>
                                <li><img src="user/img/content/payment-options/discover.png" alt="..."></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </footer>

        <!-- quantity updation  -->
        
    </div>
         <script>
            function cartquantityupdation(userId, productId, count, proPrice, availableQuantity) {  
  let quantity = parseInt(document.getElementById(productId).innerHTML);
  console.log(availableQuantity)
  console.log(quantity);
  let updatedQuantity = quantity + parseInt(count);
  console.log(updatedQuantity);

  if (updatedQuantity < 1) {

    Swal.fire({
      title: 'Invalid quantity',
      text: "Quantity cannot be less than one",
      icon: 'warning',
      confirmButtonColor: 'false',
    });
  } else if (updatedQuantity >=availableQuantity) {
    Swal.fire({
      title: 'Out of stock',
      text: "Sorry, currently unavailable!",
      icon: 'warning',
      confirmButtonColor: 'false',
    });
  } else {
    $.ajax({
      url: '/changequantity',
      data: {
        user: userId,
        product: productId,
        count: count,
        Quantity: quantity,
        proPrice: proPrice
      },
      method: 'post',
      success: (response) => {
        document.getElementById(productId).innerHTML = updatedQuantity;
        document.getElementsByClassName(productId)[0].innerHTML = response.singleproductprice;
        document.getElementById('total').innerHTML = response.sum;
      },
      error: (err) => {
        console.log('Error updating quantity:', err);
      }
    });
  }
}

    </script>

<!-- quantity updation ending -->

    <script>
        function deleteCartProduct(userId,productId) {
      console.log('hi');
      Swal.fire({
    
          title: 'Are you sure?',
          text: "You wan't to delete!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'yes, delete!'         
      }).then((result) => {
        console.log(userId);
          if (result.isConfirmed) {
              $.ajax({
                  url: '/deletecartproduct',
                  data: {
                    userId:userId,
                    deleteProId:productId
                  },
                  
                  method: 'post',
                  success: (response) => {
                      console.log("waoring")
      
                      $('#table').load('/cartitemslisting #table')
                      console.log(response);
                      Swal.fire({
                          title: 'deleted!',
                          text: 'Your deleted',
                          icon: 'success',
                          showConfirmButton: false,
                          timer:1000
                      })
                      
      console.log('delete over');
                  }
      
              })
          }
      })
      }
      
      </script>
    
    <!-- BUY TEMPLATE
    ================================================== -->
    <!-- <div class="buy-theme alt-font d-none d-lg-inline-block"><a href="https://wrapbootstrap.com/theme/smartshop-multipurpose-ecommerce-template-WB0N7CT4D" target="_blank"><i class="fas fa-cart-plus"></i><span>Buy Template</span></a></div> -->

    <!-- <div class="all-demo alt-font d-none d-lg-inline-block"><a href="https://www.chitrakootweb.com/contact.html" target="_blank"><i class="far fa-envelope"></i><span>Quick Question?</span></a></div> -->
    
    <!-- SCROLL TO TOP
    ================================================== -->
    <a href="#" class="scroll-to-top"><i class="fas fa-angle-up" aria-hidden="true"></i></a>
    
    <!-- all js include start -->

    <!-- jQuery -->
    <script src="user/js/jquery.min.js"></script>

    <!-- popper js -->
    <script src="js/popper.min.js"></script>

    <!-- bootstrap -->
    <script src="user/js/bootstrap.min.js"></script>

    <!-- core.min.js -->
    <script src="user/js/core.min.js"></script>

    <!-- custom scripts -->
    <script src="user/js/main.js"></script>
	
	<!-- all js include end -->



<%- include('../layouts/footer.ejs') %>